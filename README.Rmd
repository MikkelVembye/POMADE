---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

<img src="man/figures/POMADE_hex.png" align="right" alt="" width="180" />

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

```

# POMADE

<!-- badges: start -->
<!-- badges: end -->

The goal of the POMADE package is to provide approximation and plot functions for conducting power analysis of the correlated-hierarchical effects (CHE), multi-level meta-analysis (MLMA), and correlated-effects (CE) models for meta-analysis of dependent effect sizes developed and tested by Vembye, Pustejovsky, & Pigott (2022). These approximations replace Hedges & Pigott's (2001) previous power approximation based on the assumption of independence between effect sizes which has been shown to work inadequately to predict power for models that handle dependent effect sizes.

## Installation

You can install the development version from [GitHub](https://github.com/) with:

```{r, eval = FALSE}

# install.packages("devtools")
devtools::install_github("MikkelVembye/POMADE")

```


## Example 

Example of how to approximate power for the CHE-RVE model (Pustejovsky & Tipton, 2021)

```{r example, message=FALSE, warning=FALSE}

library(POMADE)
library(dplyr)

#?VWB22_pilot
coteach_dat <- VWB22_pilot
#glimpse(coteach_dat)

dat_kjsigma2j <- select(coteach_dat, kj, sigma2j = vg_ms_mean)

power_CHE_RVE_empirical <- 
 power_CHE(
  J = 76,
  tau2 = 0.1^2,
  omega2 = 0.25^2,
  beta = 0.1,
  rho = 0.7,
  var_df = "RVE",
  sigma2_method = "empirical",
  pilot_data_kjsigma2 = dat_kjsigma2j,
  alpha = 0.05,
  seed = 10052510
)

power_CHE_RVE_empirical

```

Making a power plot  to assess power across a range of plausible scenarios

```{r example2, message=FALSE, warning=FALSE, fig.width=12, fig.height=7}

power_CHE_RVE_plot <- 
  power_plot(
    J = seq(50, 100, 10), 
    tau2 = c(0, 0.05, 0.1, 0.2)^2,
    omega2 = c(0.05, 0.15, 0.25, 0.35)^2,
    beta = 0.1,
    rho = c(.2, .4, .7, .9),
    model = "CHE",  # Default
    var_df = "RVE", # Default
    pilot_data_kjsigma2 = dat_kjsigma2j,
    expected_studies = c(66, 86),
    iterations = 1, # Default 100
    seed = 10052510
    
  )

power_CHE_RVE_plot

```

Color plot

```{r example3, message=FALSE, warning=FALSE, fig.width=12, fig.height=7}

power_CHE_RVE_color_plot <- 
  power_plot(
    J = seq(50, 100, 10), 
    tau2 = c(0, 0.05, 0.1, 0.2)^2,
    omega2 = c(0.05, 0.15, 0.25, 0.35)^2,
    beta = 0.1,
    rho = c(.2, .4, .7, .9),
    model = "CHE",
    var_df = "RVE",
    pilot_data_kjsigma2 = dat_kjsigma2j,
    expected_studies = c(66, 86),
    color = TRUE,
    color_brewer = TRUE,
    iterations = 1, # Default 100
    seed = 10052510
  )

power_CHE_RVE_color_plot 

```

Traffic light power plot aiming to flesh out the likelihood of the given assumptions made by the reviewers

```{r example4, message=FALSE, warning=FALSE, fig.width=12, fig.height=7}

# To save plot use below commands
#png("traffic_light_power_plot.png", height = 7,  width = 12, units = "in", res = 600)
#dev.off()
traffic_light_power_plot(
  power_plot = power_CHE_RVE_color_plot,
  assumptions = c("unlikely", "likely", "expected", "likely", 
                  "unlikely", "likely", "expected", "unlikely")
)

```


# Acknowledgments 
Thanks to [Savhannah Schulz](https://savhannahschulz.netlify.app/) for making our hex stickers.   

# Reference

Hedges & Pigott (2001). The Power of Statistical Tests in Meta-Analysis. *Psychological Methods*, 6(3), 203

Pustejovsky & Tipton (2021). Meta-analysis with Robust Variance Estimation: Expanding the range of working models. *Prevention Science*, 1-14

Vembye, Pustejovsky, & Pigott (2022). Power Approximations for Meta-Analysis of Dependent Effect sizes. <https://osf.io/preprints/metaarxiv/6tp9y/>
